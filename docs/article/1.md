---
toc: content
title: '2022-05-31'
nav:
  title: æˆ‘çš„æ–‡ç« 
  order: 4
---

# æ‰‹æŠŠæ‰‹æ•™ä½ å°† dumi è‡ªåŠ¨éƒ¨ç½²åˆ° githubï¼

> ä»Šå¤©è¿™ç¯‡æ–‡ç« æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•**ä½¿ç”¨ dumi æ­å»ºåšå®¢**ä»¥åŠä½¿ç”¨ github actions å®ç°**è‡ªåŠ¨éƒ¨ç½²**ï¼Œä¸€æ¡é¾™æœåŠ¡ï¼Œèµ°èµ· ğŸ’ƒï¼

ğŸŒˆ æˆ‘çš„æˆæœï¼š[é¢„è§ˆåœ°å€](https://huhaha24.github.io/dumi-book/)

## å‰æœŸå‡†å¤‡

#### ä¸‹è½½ node

è¯·æ³¨æ„ï¼šéœ€ç¡®ä¿ node ç‰ˆæœ¬æ˜¯ 10.13 æˆ–ä»¥ä¸Šï¼ˆ[å®˜ç½‘](https://d.umijs.org/zh-CN/guide#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87)è¦æ±‚çš„ï¼‰

```
// æŸ¥çœ‹æœ¬åœ°nodeç‰ˆæœ¬ï¼Œä¸ç¬¦åˆçš„è¯ï¼Œè‡ªè¡Œå»nodeå®˜ç½‘ä¸‹è½½

$ node -v
v10.13.0
```

#### åˆ›å»º github ä»“åº“

ç”±äºæœ€ç»ˆéƒ½æ˜¯è¦éƒ¨ç½²åˆ° github çš„ï¼Œä¸å¦¨ç›´æ¥åœ¨ github åˆ›å»ºä»“åº“æ¥å­˜æ”¾ä»£ç 

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0890dd36844e412ab8eea3decd4f9ef6~tplv-k3u1fbpfcp-watermark.image?)

åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼Œæ³¨æ„ä¸€ä¸‹ï¼š

- ä»“åº“æƒé™éœ€é€‰æ‹© publicï¼Œè¦ä¸ç„¶ä¸èƒ½å…è´¹éƒ¨ç½²åˆ° githubï¼Œç§æœ‰ä»“åº“éƒ¨ç½²æ˜¯è¦æ”¶è´¹çš„
- ä¸ç”¨å‹¾é€‰ã€Add a README fileã€‘ï¼Œå› ä¸º dumi çš„è„šæ‰‹æ¶ä¸­è‡ªå¸¦ README æ–‡ä»¶

#### æ‹‰å–ä»“åº“ä»£ç 

åˆ›å»ºæˆåŠŸåï¼Œä¼šè·³åˆ°ä»“åº“ä»£ç çš„é¡µé¢ï¼Œæˆ‘ä»¬å¤åˆ¶ä¸€ä¸‹ sshã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dab8bbcd0db041f9a98dbae63c8121ef~tplv-k3u1fbpfcp-watermark.image?)

æ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥è‡ªå·±æƒ³æ”¾é¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```
$ git clone [sshåœ°å€]
```

æ‰§è¡Œå®Œä¹‹åï¼Œä½ ä¼šå‘ç°æœ¬åœ°ä¼šå¤šä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ã€‚

## æ­å»ºåšå®¢

ç”±äºæˆ‘ä»¬æ­å»ºçš„æ˜¯åšå®¢ï¼Œåªéœ€è¦é€‰æ‹©é™æ€ç«™ç‚¹æ¨¡å¼ï¼Œè¿›å…¥ä¸Šä¸€æ­¥çš„é‚£ä¸ªæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```
// ä¸‹è½½è„šæ‰‹æ¶
$ npx @umijs/create-dumi-app
# or
$ yarn create @umijs/dumi-app

// å®‰è£…npmåŒ…
$ npm install

// è¿è¡Œé¡¹ç›®
$ npm run serve
```

æ‰§è¡Œå®Œè¿™äº›å‘½ä»¤åï¼Œæ‰“å¼€ http://localhost:8080 ï¼Œå°±èƒ½çœ‹åˆ°åšå®¢æœ€åˆçš„æ ·å­ï¼Œåé¢çš„æ”¹é€ å°±çœ‹ä¸ªäººå–œå¥½å•¦ï¼

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4262670fbb0a4915a0073e6c3f52997d~tplv-k3u1fbpfcp-watermark.image?)

## è‡ªåŠ¨éƒ¨ç½²

æ‰‹åŠ¨éƒ¨ç½²è¿˜æ˜¯ä¸æ–¹ä¾¿ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨ä¸Š github å¼ºå¤§çš„ Actions åŠŸèƒ½äº†ï¼Œè·Ÿç€æˆ‘ä¸€æ­¥ä¸€æ­¥æ¥å§ï¼

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè„šæœ¬

åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º.github æ–‡ä»¶å¤¹ï¼Œåœ¨.github ä¸‹åˆ›å»º workflows æ–‡ä»¶å¤¹ï¼Œåœ¨ workflows ä¸‹åˆ›å»º ci.yml æ–‡ä»¶ï¼ˆci.yml çš„æ–‡ä»¶åå¯ä»»æ„å¡«å†™ï¼Œåªéœ€è¦ yml åç¼€å³å¯ï¼‰

.github > workflows > ci.yml

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/956ff6d6b5be4b8bb2e59567b5dca599~tplv-k3u1fbpfcp-watermark.image?)

åœ¨ ci.yml ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```yml
# é¡¹ç›®å
name: dumi book test

# åªæœ‰åœ¨masteråˆ†æ”¯å‘ç”Ÿpushäº‹ä»¶æ—¶è§¦å‘
on:
  push:
    branches:
      - master

# å·¥ä½œæµ
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # è¿è¡Œç¯å¢ƒ

    steps:
      # æ‹‰ä»£ç 
      - name: Checkout code
        uses: actions/checkout@v1

      # ä¸‹è½½nodeï¼Œæˆ‘è¿™é‡ŒæŒ‡å®šäº†15.xï¼Œè¿™ä¸ªç‰ˆæœ¬å¯éšæ„ï¼Œé«˜äºdumiè§„å®šçš„nodeç‰ˆæœ¬å³å¯
      - name: Use Node.js
        uses: actions/setup-node@v1
        with:
          node-version: 15.x

      # æ‰“åŒ…ä»£ç 
      - name: Build Project
        run: |
          npm install
          npm run build

      # éƒ¨ç½²åˆ°github
      - name: Deploy to Github
        uses: JamesIves/github-pages-deploy-action@4.0.0
        with:
          branch: build # æ‰“åŒ…çš„å†…å®¹æ”¾åˆ°buildåˆ†æ”¯ä¸‹
          folder: dist
```

psï¼šè¿™é‡ŒæŠŠæ‰“åŒ…åçš„å†…å®¹æ”¾åœ¨ build åˆ†æ”¯ï¼Œæ˜¯å› ä¸ºé˜²æ­¢ä¸‹æ¬¡ä¸‹è½½é¡¹ç›®ï¼ŒæŠŠæ‰“åŒ…åçš„å†…å®¹ä¹Ÿä¸‹è½½ä¸‹æ¥äº†ï¼Œæ”¾åœ¨ build åˆ†æ”¯å¯ä»¥æ›´å¥½åœ°ä½œåŒºåˆ†ï¼Œä¸” github ä¹Ÿèƒ½æ‹¿åˆ°å…¥å£æ–‡ä»¶ã€‚

#### ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ publicPath

è¦æƒ³ github èƒ½æ­£ç¡®æ‹¿åˆ°å…¥å£æ–‡ä»¶ï¼Œéœ€è¦åœ¨`.umirc.ts`ä¸­é…ç½®æ­£ç¡®çš„`publicPath`ï¼Œå¢åŠ å¦‚ä¸‹é…ç½®ï¼š

```js
import { defineConfig } from 'dumi';

const repo = 'dumi-book-test'; // é¡¹ç›®å

export default defineConfig({
  title: 'dumi-book-test',
  mode: 'site',
  devServer: {
    port: 1998, // è‡ªå®šä¹‰ç«¯å£å·
  },
  base: process.env.NODE_ENV === 'production' ? `/${repo}/` : '/',
  publicPath: process.env.NODE_ENV === 'production' ? `/${repo}/` : '/',

  // more config: https://d.umijs.org/config
});
```

è¿™äº›æ”¹å®Œåï¼Œpush åˆ° github ä¸Šï¼Œæ­¤æ—¶ï¼Œgithub å·²ç»å¼€å§‹å¸®ä½ æ‰“åŒ…éƒ¨ç½²äº†ã€‚

#### ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹éƒ¨ç½²è¯¦æƒ…

ç‚¹åˆ° Actions ä¸­å¯ä»¥çœ‹åˆ°éƒ¨ç½²è¯¦æƒ…ï¼Œæ‰€æœ‰ workflows é‡ŒåŒ…å«äº†è‡ªåŠ¨è§¦å‘çš„ ci å’Œæ‰‹åŠ¨è§¦å‘çš„ pages éƒ¨ç½²ã€‚

å…¶ä¸­è‡ªåŠ¨è§¦å‘çš„ workflows åç§°å°±æ˜¯ä½ çš„ yml æ–‡ä»¶ä¸­å®šä¹‰çš„ nameã€‚
![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/57636158c12346a4aa767a29c73b9415~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8795fcd9a01421ca3ea73ab8d600a3f~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ed76c00d8494eb7889caa6da5e92348~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff5b4f23ae3244cdbd6878072da00297~tplv-k3u1fbpfcp-watermark.image?)

çœ‹åˆ°ç»¿è‰²çš„å¯¹å‹¾ï¼Œè¯´æ˜å‘å¸ƒæˆåŠŸäº†ï¼Œæ¯ä¸ªæ­¥éª¤çš„è¯¦æƒ…éƒ½å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæŠ¥é”™äº†ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æ‰¾åˆ°é—®é¢˜ã€‚

#### ç¬¬å››æ­¥ï¼šé…ç½® pages

æˆ‘ä»¬åˆ° github çš„ pages é‚£é‡Œé…ç½®ä¸€ä¸‹ä¿¡æ¯ï¼Œç”±äº yml é…ç½®çš„æ˜¯æ‰“åŒ…å®Œçš„å†…å®¹æ›´æ–°åˆ° build åˆ†æ”¯ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¹Ÿéœ€è¦é€‰æ‹© build åˆ†æ”¯ï¼Œåé¢é‚£ä¸ªå°±é€‰æ‹©/rootï¼Œé€‰æ‹©å®Œäº†ä¹‹åï¼Œç‚¹å‡» saveã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1349bbc991f54584a4ab78f8100f23d4~tplv-k3u1fbpfcp-watermark.image?)

github éƒ¨ç½²ä¼šæ…¢ä¸€ç‚¹ï¼Œç­‰å¤§æ¦‚ 1 åˆ†é’Ÿï¼Œå˜æˆç»¿è‰²äº†ï¼Œå°±è¯´æ˜éƒ¨ç½²æˆåŠŸå•¦ï¼

æˆ‘ä»¬å¯ä»¥åœ¨ build åˆ†æ”¯çœ‹åˆ°æ‰“åŒ…åçš„æœ€æ–°å†…å®¹ï¼Œä»¥åŠæ›´æ–°æ—¶é—´ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b1a014c10c24456b5a659e157ab4d8a~tplv-k3u1fbpfcp-watermark.image?)

## ç»“è¯­

å¥½å•¦ï¼Œè¿™ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä½ å­¦ä¼šäº†å—ï¼Ÿç”¨äº† github Actions åå‘ç°ï¼ŒçœŸé¦™å•Šï¼æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æ›´æ–°äº† masterï¼Œä½†æ˜¯é¡µé¢å†…å®¹æ²¡æœ‰å˜çš„è¯ï¼Œè¦ä¹ˆæ˜¯æ‰“åŒ…éƒ¨ç½²å¤±è´¥ï¼Œè¦ä¹ˆå°±æ˜¯ç¼“å­˜ï¼Œgithub pages æ¯”è¾ƒå®¹æ˜“å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚
