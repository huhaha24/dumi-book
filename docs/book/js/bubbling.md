---
title: 事件机制
order: 8
toc: content
---

疑问 🤔️

- 为什么需要这些事件机制？
- 事件机制有哪些？
- 如何定义事件冒泡和事件捕获
- 在实际开发中有哪些应用场景？

# 事件机制

## 事件流

给按钮绑定一个 click 方法，然后在其父亲身上绑定一个 click 方法，点击的时候，是先执行父亲的方法还是按钮身上的方法

## 事件模型

DOM 事件模型分为事件捕获、事件冒泡。它分为 3 个传播阶段：

1. 捕获阶段：事件从 window 对象自上而下向目标节点的传播的阶段
2. 目标节点：真正的目标节点在处理事件的阶段
3. 冒泡阶段：事件从目标节点自下往上向 window 对象传播的阶段

![image.png](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/2/24/1691cf48c7538070~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

## 事件捕获

捕获是**从上往下**，将`addEventListener`的第三个参数设置为`true`就可以实现捕获。

## 事件冒泡

冒泡是**从下往上**，将`addEventListener`的第三个参数设置为`false`（或不填）就可以实现捕获。

## 事件委托

### 什么是事件委托？

由于子节点在冒泡阶段都会将事件传播到父节点，因此可以将子节点的监听函数定义在父节点上，由父节点的监听函数去统一处理子节点的事件。这个方法叫**事件委托**。

### 为什么需要事件委托？

如果子节点过多，为每个子节点单独绑定方法，是很影响性能的，不如在父元素上统一绑定，再做逻辑判断。

```html
<ul>
  <li>1</li>
  <li>2</li>
  <li>3</li>
  <li>4</li>
  <li>5</li>
  <li>6</li>
</ul>
```

如上例中，可以将事件绑定在`ul`上，这样`li`的操作可以在`ul`上进行监听。不需要每个`li`都进行绑定。

## react 中的事件机制

[react 的事件处理机制](https://juejin.cn/post/6955636911214067720)
[参考文章](https://www.cnblogs.com/echolun/p/15518631.html)

总结一下：

1. 分为 3 步：

- 事件注册
- 事件绑定
- 事件触发

react 中的 setState 是批量更新的，有一个 isBatchingEventUpdates 的变量控制是否进行批量更新；
当在 setTimeout 中执行 setState 就变成同步了
